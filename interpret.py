import sys
import numpy as np


if __name__ == '__main__':
    if len(sys.argv) < 2:
        print('Usage: interpret.py FILE[...]')
        sys.exit(1)

    metrics = ['f1', 'd2h', 'pd', 'pf', 'prec', 'acc']
    for filename in sys.argv[1:]:
        print(f'{filename}:\n{"=" * len(filename)}=')

        with open(filename, 'r') as f:
            lines = f.readlines()

        lines = [eval(x.split(':')[1]) for x in lines if x.startswith('iter')]
        lines = np.array(lines).reshape(10, 30, len(metrics))

        lines_f1 = np.apply_along_axis(lambda p: p[0], -1, lines)
        assert lines_f1.shape == (10, 30)

        max_idx = np.argmax(lines_f1, axis=-1)
        assert max_idx.shape == (10,)

        print(lines[:, max_idx])

        print(np.median(lines[:, max_idx], axis=0))
        print()
