# Vulnerability Detection

## Data

This directory contains the datasets used. The `raw/` directory contains the raw data from the Devign paper. The authors released the qemu and ffmpeg datasets.

## Preprocessing

### Step 1: Separate JSON to datasets

The raw data is processed by `preprocess.py`, which writes to `processed/`. This creates a structure like this:

```
data/
    processed/
        ffmpeg/
            1.cpp
            2.cpp
            ...
            labels.csv
        qemu/
            1.cpp
            2.cpp
            ...
            labels.csv
    raw/
        dataset.json
```

The cpp files contain the code, which will be processed by [`cppminer`](https://github.com/Kolkir/cppminer), which converts them to sequences. The CSV files contain `file` and `target` columns.

### Step 2: Convert to sequences

This stage converts the C++ files to sequences. First, run

```
pip3 install clang lmdb bitarray rouge tensorflow_addons
```

Then, in `code2seq.sh`, change lines 5 and 6 to point to your `libclang.so` or `libclang.dylib` file (the first for Linux, the second for macOS)--you can find this using

```
find / -name libclang.so 2> /dev/null
```

Then, run `code2seq.sh`
