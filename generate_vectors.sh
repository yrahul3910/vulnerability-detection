#!/bin/bash

if [ "$#" -ne 1 ]
then
    echo "Usage: ./generate_vectors.sh {ffmpeg|qemu}"
    exit 1
fi

MODEL_PATH=./models/$1/saved_model_iter18
DATA_PATH=./data/test/$1

for batch in $(ls ${DATA_PATH})
do
    TEST_FILE=${DATA_PATH}/${batch}/path_contexts.csv
    python3 code2vec.py --test ${TEST_FILE} --load ${MODEL_PATH} --export_code_vectors

    mv ${DATA_PATH}/${batch}/path_contexts.csv.vectors ${DATA_PATH}/${batch}.vectors
    rm -rf ${DATA_PATH}/${batch}/
done

