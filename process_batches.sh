#!/bin/bash

DATA_DIR=./data/test
ASTMINER_OPTIONS="--split-tokens --granularity method" 

for folder in $(ls ${DATA_DIR}/ffmpeg/)
do
    if [ -f ${DATA_DIR}/ffmpeg/$folder/path_contexts.csv ]
    then
        printf "Skipping $folder\n"
        continue
    fi

    cd astminer/
    ./cli.sh code2vec --lang cpp \
        --project .${DATA_DIR}/ffmpeg/$folder \
        --output .${DATA_DIR}/ffmpeg/$folder $ASTMINER_OPTIONS
    
    cd ../
    rm ${DATA_DIR}/ffmpeg/$folder/*.cpp && \
    mv ${DATA_DIR}/ffmpeg/$folder/cpp/* ${DATA_DIR}/ffmpeg/$folder
done

for folder in $(ls ${DATA_DIR}/qemu/)
do
    if [ -f ${DATA_DIR}/ffmpeg/$folder/path_contexts.csv ]
    then
        printf "Skipping $folder\n"
        continue
    fi

    cd astminer/
    ./cli.sh code2vec --lang cpp \
        --project .${DATA_DIR}/qemu/$folder \
        --output .${DATA_DIR}/qemu/$folder $ASTMINER_OPTIONS

    cd ../
    rm ${DATA_DIR}/qemu/$folder/*.cpp
    mv ${DATA_DIR}/qemu/$folder/cpp/* ${DATA_DIR}/qemu/$folder
done
    
