from pathlib import Path
from shutil import copyfile


def main(project: str):
    data_path = Path(f'./data/processed/{project}')
    test_dir = Path(f'./data/test/{project}')
    step_size = 1

    if not test_dir.exists():
        test_dir.mkdir(parents=True)

    files = list(data_path.glob('*.cpp'))
    for i in range(0, len(files), step_size):
        # Create the current batch
        batch_dir = test_dir / f'{int(i // step_size):05}'
        batch_dir.mkdir(exist_ok=True)

        for j in range(i, i + step_size):
            filename = data_path / f'{j}.cpp'

            if filename.exists():
                copyfile(filename, batch_dir / f'{j}.cpp')


if __name__ == '__main__':
    main('ffmpeg')
    main('qemu')
